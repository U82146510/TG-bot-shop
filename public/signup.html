<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Signup</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    h2 { margin-top: 30px; }
    form, .output { margin-bottom: 20px; padding: 10px; border: 1px solid #000; }
    label { display: block; margin-top: 5px; }
    input, button { margin-top: 5px; padding: 5px; width: 100%; }
    pre { white-space: pre-wrap; word-wrap: break-word; }
    nav {
        margin-bottom: 20px;
    }
    nav a {
        margin-right: 10px;
        text-decoration: none;
        color: black;
        font-weight: bold;
    }
    nav a:hover {
        text-decoration: underline;
    }
  </style>
</head>
<body>

  <h1>Admin Control Panel</h1>

  <nav>
    <a href="/users.html">Users</a>
    <a href="/orders.html">Orders</a>
    <a href="/products.html">Products</a>
    <a href="/items.html">Items</a>
    <a href="/reviews.html">Reviews</a>
    <a href="/payments.html">Payments</a>
    <a href="/signup.html">Create User</a>
  </nav>

  <h2>Register New Admin</h2>

  <form id="signup-form">
    <label>Email:</label>
    <input type="email" name="email" required>

    <label>Password:</label>
    <input type="password" name="password" required>

    <label>Pin (8 digits):</label>
    <input type="password" name="pinCode" required>

    <button type="submit">Create User</button>
  </form>

  <div class="output">
    <pre id="signup-output">Awaiting signup...</pre>
  </div>

  <script>
    const signupForm = document.getElementById('signup-form');
    const signupOutput = document.getElementById('signup-output');

    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(signupForm);
      const email = formData.get('email');
      const password = formData.get('password');
      const pinCode = formData.get('pinCode');

      if (!email || !password || !pinCode) {
        signupOutput.textContent = 'Please fill all fields.';
        return;
      }

      try {
        const res = await fetch('/auth/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, pinCode })
        });

        const contentType = res.headers.get('content-type');
        if (!res.ok) {
          const text = await res.text();
          signupOutput.textContent = `Error ${res.status}: ${text}`;
          return;
        }

        if (contentType && contentType.includes('application/json')) {
          const data = await res.json();
          signupOutput.textContent = 'User created successfully. Redirecting...';
          setTimeout(() => {
            window.location.href = '/users.html';
          }, 1000);
        } else {
          const text = await res.text();
          signupOutput.textContent = text;
        }
      } catch (err) {
        signupOutput.textContent = `Error: ${err.message}`;
      }
    });
  </script>

</body>
</html>
